<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
      <script src='../lib/p5/p5.min.js'></script>
      <script src='../lib/p5/p5.sound.min.js'></script>
      <script src="../lib/wavesurfer.js"></script><!--
      <script src='https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.10/addons/p5.sound.min.js
                   '></script>-->
      <!--
      <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/0.2.0/Chart.min.js" type="text/javascript"'></script>
      -->
    <title></title>
  </head>
  <body>
    <!--<canvas id="myChart" width="400" height="400"></canvas>-->
      <div id="waveform"></div>
  </body>
    
</html>

<script>
    let fs = require('fs');
    let util = require('audio-buffer-utils');
    //LUNCH MIDI MODULES
    //require('./midi.js');

    //LUNCH OSC MODULES
    //require('./osc.js');
    
    
    var wavesurfer = WaveSurfer.create({
        container: '#waveform',
        waveColor: 'violet',
        progressColor: 'purple'
    }); 
    wavesurfer.load('../assets/click.wav');
    //console.log(wavesurfer)
    //console.log(wavesurfer)
    //wavesurfer._playAudioLikeBuffer();
    
    
    var song, analyzer;

    function preload() {
        song = loadSound('../assets/click.wav');
        //console.dir(song.processPeaks)
    }
     

    function setup() {
        createCanvas(710, 200);
        //song.play();
        // create a new Amplitude analyzer
        analyzer = new p5.Amplitude();
        
        // Patch the input to an volume analyzer
        analyzer.setInput(song);
        //console.log(analyzer)
        //console.log(getRandomIntInclusive(0, 255));
        console.log(wavesurfer)
    }
    
    
    function getRandomIntInclusive(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        var rgb = {
            r: Math.floor(Math.random() * (max - min + 1)) + min,
            g: Math.floor(Math.random() * (max - min + 1)) + min,
            b: Math.floor(Math.random() * (max - min + 1)) + min
        }
        return rgb;
    }
    

    function draw() {
      background(255);
        //console.log(this)
      // Get the average (root mean square) amplitude
      var rms = analyzer.getLevel();
        _tempRms = 0;
        if(rms > 0.1) {
            _tempRms = rms;
        }
      fill(127);
      stroke(0);

      // Draw an ellipse with size based on volume
      ellipse(width/2, height/2, 10+_tempRms*200, 10+_tempRms*200);
    }
    
    
    
    

    
</script>